{% extends 'base.html' %}
{% block content %}

<style>
  .cart-img {
    width: 80px;
    height: 80px;
    object-fit: cover;
    border-radius: 10px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  }

  .qty-btn {
    padding: 2px 10px;
    font-weight: bold;
  }
</style>

<h2 class="mb-4">ðŸ›’ Your Cart</h2>

{% if items %}
<ul class="list-group mb-4">

{% for it in items %}
<li class="list-group-item d-flex justify-content-between align-items-center">

  <!-- LEFT -->
  <div class="d-flex align-items-center">
    <img src="{{ url_for('uploaded_file', filename=it.art.image_filename) }}"
         class="cart-img me-3"
         onerror="this.src='{{ url_for('static', filename='images/placeholder.png') }}'">

    <div>
      <strong>{{ it.art.title }}</strong><br>
      <small class="text-muted">{{ it.art.artist_name }}</small>
      <div class="text-muted">Stock: {{ it.art.available_qty }}</div>
    </div>
  </div>

  <!-- RIGHT -->
  <div class="text-end">
    <div class="mb-2">
      <a href="{{ url_for('update_cart', artwork_id=it.art.artwork_id, action='decrease') }}"
         class="btn btn-sm btn-outline-secondary qty-btn">âˆ’</a>

      <span class="mx-2 fw-bold">{{ it.qty }}</span>

      <a href="{{ url_for('update_cart', artwork_id=it.art.artwork_id, action='increase') }}"
         class="btn btn-sm btn-outline-secondary qty-btn
         {% if it.qty >= it.art.available_qty %}disabled{% endif %}">
         +
      </a>
    </div>

    <div class="fw-bold text-success mb-1">â‚¹{{ it.subtotal }}</div>

    <a href="{{ url_for('update_cart', artwork_id=it.art.artwork_id, action='remove') }}"
       class="btn btn-sm btn-danger">Remove</a>
  </div>

</li>
{% endfor %}

</ul>

<h5 class="fw-bold">Subtotal: â‚¹{{ total }}</h5>

{% if discount_percentage > 0 %}
<div class="alert alert-success mt-3">
  ðŸŽ‰ <strong>{{ discount_percentage }}% Discount Applied</strong><br>
  ðŸ’¸ Discount: âˆ’ â‚¹{{ discount_amount }}<br>
  ðŸ’µ <strong>Payable Amount: â‚¹{{ total_after_discount }}</strong>
</div>
{% else %}
<div class="alert alert-info mt-3">
  ðŸ’¡ Add items worth â‚¹{{ 5000 - total }} more to get 10% discount!
</div>
{% endif %}

<form method="post" action="{{ url_for('checkout') }}" class="mt-3">
  <button class="btn btn-primary px-4">Proceed to Checkout</button>
</form>

{% else %}
<div class="alert alert-info">Your cart is empty.</div>
{% endif %}

{% endblock %}
